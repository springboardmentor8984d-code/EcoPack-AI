<!DOCTYPE html>
<html>
<head>
<title>EcoPack AI Dashboard</title>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

<style>
body {
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(135deg, #a3c09b, #dde8cf);
    margin: 0;
}

/* HEADER */
.header {
    text-align: center;
    padding: 20px;
}

.header h1 {
    margin: 0;
    font-size: 28px;
}

/* CONTAINER */
.container {
    width: 90%;
    margin: auto;
}

/* METRICS */
.metrics {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-bottom: 20px;
    flex-wrap: wrap;
}

.metric-card {
    background: white;
    padding: 15px 25px;
    border-radius: 15px;
    box-shadow: 0 6px 15px rgba(0,0,0,0.1);
    min-width: 180px;
    text-align: center;
}

/* TABLE */
.table-card {
    background: white;
    border-radius: 15px;
    padding: 20px;
    box-shadow: 0 6px 15px rgba(0,0,0,0.1);
    overflow-x: auto;
}

table {
    width: 100%;
    border-collapse: collapse;
}

th {
    background: #6a8d63;
    color: white;
}

th, td {
    padding: 10px;
    text-align: center;
}

/* GRID */
.grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
}

/* CHART CARD */
.chart-card {
    background: white;
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 6px 15px rgba(0,0,0,0.1);
}

/* BUTTON */
.btn {
    display: inline-block;
    margin: 10px;
    padding: 12px 25px;
    background-color: #6a8d63;
    color: white;
    text-decoration: none;
    border-radius: 10px;
}

.btn:hover {
    background-color: #486244;
}

/* RESPONSIVE */
@media (max-width: 768px) {
    .grid {
        grid-template-columns: 1fr;
    }
}
</style>
</head>

<body>

<div class="header">
    <h1>üåø EcoPack AI Dashboard</h1>
</div>

<div class="container">

<!-- METRICS -->
<div class="metrics">
    <div class="metric-card">
        <strong>Avg CO‚ÇÇ Reduction</strong><br>
        {{ avg_co2 | round(2) if avg_co2 else 0 }} %
    </div>

    <div class="metric-card">
        <strong>Avg Cost Savings</strong><br>
        ‚Çπ {{ avg_cost | round(2) if avg_cost else 0 }}
    </div>
</div>

<!-- TABLE -->
<div class="table-card">
    <table>
        <tr>
            <th>Rank</th>
            <th>Material</th>
            <th>Cost</th>
            <th>CO‚ÇÇ</th>
            <th>Score</th>
        </tr>

        {% for r in results %}
        <tr>
            <td>{{ loop.index }}</td>
            <td>{{ r.material_name }}</td>
            <td>{{ r.predicted_cost | round(2) }}</td>
            <td>{{ r.predicted_co2 | round(2) }}</td>
            <td>{{ r.suitability_score | round(3) }}</td>
        </tr>
        {% endfor %}
    </table>
</div>

<br>

<!-- CHARTS -->
<div class="grid">

    <div class="chart-card">
        <h3>CO‚ÇÇ Comparison (Sorted: Low ‚Üí High)</h3>
        <div id="co2Chart"></div>
    </div>

    <div class="chart-card">
        <h3>Cost Comparison (Sorted: Low ‚Üí High)</h3>
        <div id="costChart"></div>
    </div>

</div>

<br>

<!-- MATERIAL USAGE -->
<div class="chart-card">
    <h3>Material Usage (All Recommendations)</h3>
    <div id="usageChart"></div>
</div>

<!-- EXPORT BUTTONS -->
<div style="text-align: center;">
    <a href="/export_excel" class="btn">üìä Export Excel</a>
    <a href="/export_pdf" class="btn">üìÑ Export PDF</a>
</div>

<!-- BACK BUTTON -->
<div style="text-align:center;">
    <a href="/" class="btn">‚Üê Go Back</a>
</div>

</div>

<script>

// ===== GET DATA =====
var materials = [{% for r in full_data[:5] %}"{{ r.material_name }}",{% endfor %}];
var co2_vals = [{% for r in full_data[:5] %}{{ r.predicted_co2 }},{% endfor %}];
var cost_vals = [{% for r in full_data[:5] %}{{ r.predicted_cost }},{% endfor %}];

// ===== SORT DATA =====
function sortData(labels, values) {
    let combined = labels.map((l, i) => ({label: l, value: values[i]}));
    combined.sort((a, b) => a.value - b.value);
    return {
        labels: combined.map(x => x.label),
        values: combined.map(x => x.value)
    };
}

var co2_sorted = sortData(materials, co2_vals);
var cost_sorted = sortData(materials, cost_vals);

// ===== CO2 CHART (GREEN) =====
Plotly.newPlot('co2Chart', [{
    x: co2_sorted.labels,
    y: co2_sorted.values,
    type: 'bar',
    marker: { color: 'green' }
}], {
    margin:{t:30},
    xaxis:{title:"Material"},
    yaxis:{title:"CO‚ÇÇ (Lower = Better)"}
});

// ===== COST CHART (RED) =====
Plotly.newPlot('costChart', [{
    x: cost_sorted.labels,
    y: cost_sorted.values,
    type: 'bar',
    marker: { color: 'crimson' }
}], {
    margin:{t:30},
    xaxis:{title:"Material"},
    yaxis:{title:"Cost (Lower = Better)"}
});

// ===== USAGE CHART =====
Plotly.newPlot('usageChart', [{
    x: {{ usage_labels | safe }},
    y: {{ usage_values | safe }},
    type: 'bar',
    marker: { color: '#6a8d63' }
}], {
    margin:{t:30},
    xaxis:{title:"Material"},
    yaxis:{title:"Usage Count"}
});

</script>

</body>
</html>