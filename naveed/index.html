<!DOCTYPE html>
<html>
<head>
    <title>EcoPackAI - Sustainable Packaging Dashboard</title>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
body {
    font-family: 'Segoe UI';
    background: linear-gradient(to right, #e8f5e9, #fdf6ec);
    padding: 30px;
}

h1 {
    text-align: center;
    color: #2f4f4f;
}

.card {
    background: white;
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 25px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}

select, button {
    padding: 8px 12px;
    margin: 5px;
    border-radius: 6px;
    border: 1px solid #ccc;
}

button {
    background: #2f6f6f;
    color: white;
    cursor: pointer;
}

button:hover { background: #245757; }

table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
}

th, td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: center;
}

th {
    background: #2f6f6f;
    color: white;
}

.flex-row {
    display: flex;
    gap: 20px;
    justify-content: space-between;
}

.info-box {
    flex: 1;
    padding: 20px;
    border-radius: 10px;
    text-align: center;
    font-weight: bold;
    cursor: pointer;
}

.green { background: #d8f3dc; }
.orange { background: #ffe8cc; }
.blue { background: #e0e7ff; }

footer {
    text-align: center;
    margin-top: 40px;
    color: #555;
}

/* MODAL */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    animation: fadeIn 0.3s;
}

.modal-content {
    background: white;
    margin: 5% auto;
    padding: 20px;
    width: 70%;
    border-radius: 10px;
    animation: slideUp 0.4s;
}

.close {
    float: right;
    font-size: 22px;
    cursor: pointer;
}

@keyframes fadeIn {
    from {opacity:0}
    to {opacity:1}
}

@keyframes slideUp {
    from {transform:translateY(50px); opacity:0}
    to {transform:translateY(0); opacity:1}
}
</style>
</head>

<body>

<h1>EcoPackAI - Sustainable Packaging Intelligence</h1>

<div class="card">
<b>Recommendation Selection</b><br>

<select id="category">
<option>electronics</option>
<option>food</option>
<option>cosmetics</option>
<option>pharmaceuticals</option>
<option>fragile_goods</option>
<option>textiles</option>
<option>furniture</option>
<option>industrial_parts</option>
<option>stationery</option>
<option>ecommerce_general</option>
</select>

<select id="fragility">
<option>high</option>
<option>medium</option>
<option>low</option>
</select>

<select id="shipping">
<option>national</option>
<option>international</option>
</select>

<select id="priority">
<option>high</option>
<option>medium</option>
<option>low</option>
</select>

<button onclick="generate()">Generate Output</button>
<button onclick="resetAll()">Reset</button>
</div>

<div class="card">
<b>Material Prediction</b>
<table>
<thead>
<tr>
<th>Material</th>
<th>Cost</th>
<th>CO₂</th>
<th>Suitability</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>
</div>

<div class="flex-row">
<div class="info-box green" onclick="openCO2()">Avg CO₂ Reduction<br><span id="avgCO2">--</span></div>
<div class="info-box orange" onclick="openCost()">Avg Cost Saving<br><span id="avgCost">--</span></div>
<div class="info-box blue">
Export<br>
<button onclick="exportPDF()">PDF Summary</button><br>
<button onclick="exportExcel()">Excel Ranking</button>
</div>
</div>

<div class="card">
<canvas id="mainChart"></canvas>
</div>

<!-- NEW CHARTS ADDED BELOW -->

<div class="card">
    <h3>Material vs Suitability Score (Vertical Bar Chart)</h3>
    <canvas id="verticalBarChart"></canvas>
</div>

<div class="card">
    <h3>Material vs Suitability Score (Horizontal Bar Chart)</h3>
    <canvas id="horizontalBarChart"></canvas>
</div>

<!-- MODALS -->

<div id="co2Modal" class="modal">
<div class="modal-content">
<span class="close" onclick="closeModal('co2Modal')">&times;</span>
<h3>CO₂ Reduction Analysis</h3>
<canvas id="co2Chart"></canvas>
</div>
</div>

<div id="costModal" class="modal">
<div class="modal-content">
<span class="close" onclick="closeModal('costModal')">&times;</span>
<h3>Cost Saving Analysis</h3>
<canvas id="costChart"></canvas>
</div>
</div>

<footer>
EcoPackAI © 2026 | AI Powered Sustainable Packaging Intelligence
</footer>

<script>

let recommendations=[];
let mainChart;
let verticalChart;
let horizontalChart;

async function generate(){
const res=await fetch("http://127.0.0.1:5000/recommend",{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({
product_category:category.value,
fragility:fragility.value,
shipping_type:shipping.value,
sustainability_priority:priority.value
})
});

const data=await res.json();
recommendations=data.recommended_materials;

populateTable();
calculateAvg();
drawMainChart();
drawExtraCharts();
}

function populateTable(){
tableBody.innerHTML="";
recommendations.forEach(r=>{
tableBody.innerHTML+=`
<tr>
<td>${r.material}</td>
<td>${r.predicted_cost.toFixed(2)}</td>
<td>${r.predicted_co2.toFixed(2)}</td>
<td>${r.suitability_score.toFixed(2)}</td>
</tr>`;
});
}

function calculateAvg(){
let avgCO2Val=recommendations.reduce((a,b)=>a+b.predicted_co2,0)/recommendations.length;
let avgCostVal=recommendations.reduce((a,b)=>a+b.predicted_cost,0)/recommendations.length;
avgCO2.innerText=avgCO2Val.toFixed(2);
avgCost.innerText=avgCostVal.toFixed(2);
}

function drawMainChart(){
if(mainChart) mainChart.destroy();
mainChart=new Chart(document.getElementById("mainChart"),{
type:"bar",
data:{
labels:recommendations.map(x=>x.material),
datasets:[{
label:"Suitability Score",
data:recommendations.map(x=>x.suitability_score)
}]
}
});
}

function drawExtraCharts(){

if(verticalChart) verticalChart.destroy();
if(horizontalChart) horizontalChart.destroy();

const labels=recommendations.map(x=>x.material);
const scores=recommendations.map(x=>x.suitability_score);

verticalChart=new Chart(document.getElementById("verticalBarChart"),{
type:"bar",
data:{
labels:labels,
datasets:[{
label:"Suitability Score",
data:scores
}]
},
options:{scales:{y:{beginAtZero:true}}}
});

horizontalChart=new Chart(document.getElementById("horizontalBarChart"),{
type:"bar",
data:{
labels:labels,
datasets:[{
label:"Suitability Score",
data:scores
}]
},
options:{
indexAxis:'y',
scales:{x:{beginAtZero:true}}
}
});
}

function openCO2(){
document.getElementById("co2Modal").style.display="block";
new Chart(document.getElementById("co2Chart"),{
type:"line",
data:{
labels:recommendations.map(x=>x.material),
datasets:[{
label:"CO₂ Reduction",
data:recommendations.map(x=>x.predicted_co2),
fill:true
}]
}
});
}

function openCost(){
document.getElementById("costModal").style.display="block";
new Chart(document.getElementById("costChart"),{
type:"line",
data:{
labels:recommendations.map(x=>x.material),
datasets:[{
label:"Cost Saving",
data:recommendations.map(x=>x.predicted_cost),
fill:true
}]
}
});
}

function closeModal(id){
document.getElementById(id).style.display="none";
}

function exportPDF(){
const {jsPDF}=window.jspdf;
const doc=new jsPDF();
doc.setFontSize(14);
doc.text("EcoPackAI - Sustainability Report",10,15);
doc.autoTable({
startY:25,
head:[["Material","Cost","CO₂","Suitability"]],
body:recommendations.map(r=>[
r.material,
r.predicted_cost.toFixed(2),
r.predicted_co2.toFixed(2),
r.suitability_score.toFixed(2)
])
});
doc.save("EcoPackAI_Report.pdf");
}

function exportExcel(){
const ws=XLSX.utils.json_to_sheet(recommendations);
const wb=XLSX.utils.book_new();
XLSX.utils.book_append_sheet(wb,ws,"Ranking");
XLSX.writeFile(wb,"EcoPackAI_Ranking.xlsx");
}

function resetAll(){
tableBody.innerHTML="";
avgCO2.innerText="--";
avgCost.innerText="--";
if(mainChart) mainChart.destroy();
if(verticalChart) verticalChart.destroy();
if(horizontalChart) horizontalChart.destroy();
}

</script>

</body>
</html>